<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arc Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { arc: { blue: '#004a99', teal: '#38b6ff', dark: '#002d5e' } } } }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .view { display: none; } .view.active { display: block; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen selection:bg-arc-teal">

    <div id="view-login" class="view active min-h-screen flex items-center justify-center bg-arc-dark p-6 text-center">
        <div class="max-w-md w-full bg-white rounded-[2.5rem] p-12 shadow-2xl text-center">
            <img src="arc.jpg" alt="Logo" class="h-20 mx-auto mb-10" onerror="this.src='https://placehold.co/200x80?text=Arc+Systems'">
            <h1 class="text-2xl font-black text-slate-800 uppercase mb-8 text-center">Admin Access</h1>
            <input type="password" id="admin-pass" placeholder="Authorization Key" onkeydown="if(event.key === 'Enter') checkAdmin()" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl py-5 px-6 focus:outline-none focus:border-arc-blue font-bold text-center text-lg mb-6">
            <button onclick="checkAdmin()" class="w-full bg-arc-blue text-white py-5 rounded-2xl font-black hover:bg-arc-dark transition-all uppercase tracking-widest shadow-xl">Enter Hub</button>
            <p id="err" class="text-red-500 text-xs mt-4 font-bold hidden">Invalid Key</p>
        </div>
    </div>

    <div id="view-dashboard" class="view min-h-screen flex flex-col">
        <nav class="bg-white border-b border-slate-100 px-8 py-5 flex justify-between items-center sticky top-0 z-50 shadow-sm text-left">
            <div class="flex items-center gap-4 text-left"><img src="arc.jpg" alt="Logo" class="h-8"><span class="text-arc-blue font-black uppercase text-[10px]">Admin Hub</span></div>
            <button onclick="location.reload()" class="bg-slate-50 px-4 py-2 rounded-xl text-slate-400 hover:text-red-500 font-bold text-xs text-center">Sign Out</button>
        </nav>
        <div class="max-w-7xl mx-auto w-full p-8 flex-1 text-left">
            <div class="flex justify-between items-center mb-12 text-left">
                <h1 class="text-5xl font-black text-slate-900 tracking-tighter text-left">Candidate Log</h1>
                <button onclick="fetchResults()" class="bg-arc-blue text-white px-6 py-3 rounded-xl font-black text-xs uppercase hover:bg-arc-dark shadow-lg flex items-center gap-2"><i data-lucide="refresh-cw" class="w-4 h-4 text-center"></i> Sync Cloud</button>
            </div>
            <div id="list" class="space-y-4 text-left">
                <div class="text-center py-20 text-slate-400 font-bold uppercase text-xs">Waiting for cloud data...</div>
            </div>
        </div>
    </div>

    <script>
        const AUTH_KEY = "A2c5ySt3m5ExamR35u1ts";
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxYyFFfpUeSJh0t9YvxKtQCyKSKQjUd0UJqa5EBVo-UT7vigh6xOyBCft-oEvKFWL9M/exec";

        function checkAdmin() {
            if (document.getElementById('admin-pass').value.trim() === AUTH_KEY) {
                document.getElementById('view-login').style.display = 'none';
                document.getElementById('view-dashboard').style.display = 'block';
                fetchResults();
            } else {
                document.getElementById('err').style.display = 'block';
                setTimeout(() => document.getElementById('err').style.display = 'none', 3000);
            }
        }

        async function fetchResults() {
            const list = document.getElementById('list');
            try {
                const response = await fetch(SCRIPT_URL);
                const data = await response.json();
                render(data.reverse());
            } catch (err) {
                list.innerHTML = '<div class="text-center py-20 text-red-400 font-bold uppercase text-xs">Cloud Access Error. Check Google Apps Script doGet().</div>';
            }
        }

        function render(data) {
            const list = document.getElementById('list'); list.innerHTML = '';
            if (data.length === 0) { list.innerHTML = '<div class="text-center py-20 text-slate-400 font-bold uppercase text-xs">No records found.</div>'; return; }
            data.forEach(res => {
                const levelId = res.levelTitle.includes("1st") ? 1 : res.levelTitle.includes("2nd") ? 2 : 3;
                const nextLink = `https://arcsystemsdartford.github.io/exam-centre/?level=${levelId + 1}`;
                const card = document.createElement('div');
                card.className = "bg-white border border-slate-100 rounded-[2rem] p-6 shadow-sm hover:shadow-lg flex justify-between items-center group text-left";
                card.innerHTML = `<div class="flex items-center gap-6 text-left"><div class="w-12 h-12 rounded-xl ${res.status === 'PASSED' ? 'bg-emerald-50 text-emerald-500' : 'bg-red-50 text-red-500'} flex items-center justify-center shrink-0"><i data-lucide="${res.status === 'PASSED' ? 'check-circle' : 'x-circle'}" class="w-6 h-6"></i></div><div><h4 class="text-lg font-black text-slate-800">${res.candidateName}</h4><p class="text-xs font-bold text-slate-400">${res.candidateEmail}</p></div></div><div class="flex items-center gap-10 text-right"><div><p class="text-[9px] font-black uppercase text-slate-400 mb-1">${res.levelTitle}</p><p class="text-xl font-black ${res.status === 'PASSED' ? 'text-emerald-600' : 'text-slate-900'}">${res.score}</p></div><button onclick="copyLink('${nextLink}')" class="bg-arc-blue text-white px-4 py-2 rounded-xl font-black text-[9px] uppercase hover:bg-arc-dark shadow-md">Copy Link</button></div>`;
                list.appendChild(card);
            });
            lucide.createIcons();
        }

        function copyLink(link) {
            const el = document.createElement('textarea'); el.value = link; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
            alert("Link copied! Send to candidate to authorize Level " + link.slice(-1));
        }

        lucide.createIcons();
    </script>
</body>
</html>
